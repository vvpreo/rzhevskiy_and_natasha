# Discovery for Services
Каждый сервис решения должен "знать" где находится другой сервис.
Этот проект предлагает инструменты и процессы для решения проблемы
`discovery` в сервисной архитектуре.

## Регистр сервисов
Главный оркестрирующий компоенент решения - регистр сервисов, 
который позволяет получить информацию о том, по какому IP и на каком порту
находятся сервисы решения.

Для этого предполагается использовать consul:
https://www.consul.io/

Каждый сервис, при запуске должен зарегистрироваться в Консул, чтобы его могли 
обнаружить другие сервисы. Подерживается возможность регистрации нескольких
инстансов stateless сервисов (в том числе на различных серверах в различных датацентрах)

Консул является кластерным решением, обеспечивающим синхронизацию данных регистра
между агентами. Соответственно, не будет являться Точкой отказа решения.

Консул может предоставлять информацию через два интерфейса:
* Как запись в DNS
* Через прямое обращение по REST

Регистрация сервисов осуществляется только через REST интерфейс.

Этот проект содержит все необходимые зависимости и процедуры для
* Регистрации сервиса
* Обращения к другому сервису через DNS с использованием SRV записи опционально
* Обращения к другому сервису через REST обращение к регистру, в случае, если DNS не доступен

TBD: Шифрование, georedundency

# Пример
## Подгтовка 
* установить docker и docker-compose
* sudo доступ
* Unix like OS

# Шаги
* Переходим в папку `scripts` проекта.
* Создайте докер подсеть для консула:

  `bash ./create_common_bridge_network.sh`
* Запустите consul докере: 
  
  `bash ./run_consul.sh`

* Проверить работу консула пройдя по ссылке:

  http://172.20.0.2:8500

* Добавьте консул в список DNS (работает unix систем):

  `sudo bash ./add_consul_to_list_of_dns.sh`

* Перезапустите systemd-resolv для применения изменений

  `sudo systemctl restart systemd-resolved.service`

* Установить зависимости
  
  `pip install -r requirements.txt`
  
* Запустите сервис 1 и Проверьте работу метода hello (см STDOUT):

  `bash ./run_rzhevskiy.sh`

* Запустите сервис 2 и Проверьте работу метода hello (см STDOUT):
  
  `bash ./run_natasha.sh`

* Проверьте работу методов ask_for_hello у 1го и 2го сервисов.
  
  см STDOUT


